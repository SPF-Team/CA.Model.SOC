(function(a,b,c){String.prototype.format=function(){var d=arguments;return this.replace(/\{(\d+)\}/g,function(e,f){return d[f]})};b.extend({CA:function(u){var n={speed:500,target:".ca_container",size:{x:10,y:7},threshold:5,template:{line:"#temp_line",item:"#temp_item"},isClose:true,noHoldExt:false,noColor:false},q,z,j,y=[],s=[],g,v,D=0,r=0,C=false,l=false,C=false,B=false,p=false;n=b.extend({},n,u);function e(G){var E=[],F=0,o=G.length;for(;F<o;F++){if(G[F] instanceof Array){E[F]=e(G[F])}else{E[F]=G[F]}}return E}function f(o,E){return parseInt(Math.random()*(o-E+1)+E)}function m(o){var E={},F;for(t in o){F=b(o[t]).html(),E[t]=F.substring(6,F.length-3)}return E}function d(o,E){return y[o][E]}function h(o,E){return j.eq(E*n.size.x+o)}function x(E,H,G,o){y[E][H]=G;var F=j.eq(H*n.size.x+E);F.find("span").text(G);if(!n.noColor&&!o){w(F,c,G)}}function k(E,o){for(i in o){E.css(i,o[i])}}function w(F,E,H){if(E==c){if(F.hasClass("act")){F.attr("class","act c"+H)}else{F.attr("class","c"+H)}}else{var G=h(F,E);if(G.hasClass("act")){G.attr("class","act c"+H)}else{G.attr("class","c"+H)}}}function A(){if(B){return}B=true;var E=0;b("#circle").text(++r);s=e(y);if(!n.noColor&&n.noHoldExt){j.removeClass("loop")}if(!n.noColor){j.removeClass("curloop")}else{j.attr("class","")}for(var F=0;F<n.size.x;F++){for(var o=0;o<n.size.y;o++){if(d(F,o)<n.threshold){continue}if(F>0){s[F-1][o]+=1,s[F][o]-=1}if(o>0){s[F][o-1]+=1,s[F][o]-=1}if(F<n.size.x-1){s[F+1][o]+=1,s[F][o]-=1}if(o<n.size.y-1){s[F][o+1]+=1,s[F][o]-=1}}}for(var F=0;F<n.size.x;F++){for(var o=0;o<n.size.y;o++){if(s[F][o]!=d(F,o)){x(F,o,s[F][o]);if(!n.noColor){h(F,o).addClass("loop").addClass("curloop")}else{h(F,o).attr("class","loop")}}E+=(d(F,o)>=n.threshold)}}if(E==0){C=false;clearInterval(v)}B=false}return{init:function(G){n=b.extend({},n,G);q=b(n.target);y=[];for(var F=0;F<n.size.x;F++){y.push(new Array(n.size.y));for(var E=0;E<n.size.y;E++){y[F][E]=0}}this.build()},build:function(){var G="",o=m(n.template),H="";for(var E=0;E<n.size.y;E++){H="";for(var F=0;F<n.size.x;F++){H+=o["item"].format(F,E,0)}G+=o["line"].format(E,H)}q.append(G);j=q.find("li div")},start:function(){if(p){return}if(l){return}p=true;l=true;~function(){C=true;B=false;r=0;v=setInterval(A,n.speed)}();g=setInterval(function(){if(C){return}b("#times").text(D++);if(!n.noColor){j.removeClass("act")}else{j.attr("class","")}if(!n.noColor&&!n.noHoldExt){j.removeClass("loop").removeClass("curloop")}var o={x:0,y:0},E;o.x=f(-1,n.size.x);o.y=f(-1,n.size.y);E=h(o.x,o.y);x(o.x,o.y,d(o.x,o.y)+1);E.addClass("act");if(d(o.x,o.y)>=n.threshold){C=true;r=0;B=false;v=setInterval(A,n.speed)}else{C=false}l=false;if(r>1){console.log("step:"+D+";circle:"+r+";")}},n.speed)},nextStep:function(){this.pause();C=true;~function(){B=false;A()}();~function(){if(C){return}b("#times").text(D++);if(!n.noColor){j.removeClass("act")}else{j.attr("class","")}if(!n.noColor&&!n.noHoldExt){j.removeClass("loop").removeClass("curloop")}var o={x:0,y:0},E;o.x=f(-1,n.size.x);o.y=f(-1,n.size.y);E=h(o.x,o.y);x(o.x,o.y,d(o.x,o.y)+1);E.addClass("act");if(d(o.x,o.y)>=n.threshold){r=0;B=false;A}else{C=false}}()},pause:function(){p=false;C=false;B=false;l=false;clearInterval(g);clearInterval(v)},setV:function(G){var F;if(p){F=true;p=false}for(var E=0;E<n.size.x;E++){for(var o=0;o<n.size.y;o++){x(E,o,G)}}if(F){p=true}},setRandom:function(){var F;if(p){F=true;p=false}for(var E=0;E<n.size.x;E++){for(var o=0;o<n.size.y;o++){x(E,o,f(-1,5))}}if(F){p=true}},run_state:function(){return p}}}})})(window,$);(function(a,b,c){b(document).ready(function(){var d=b.CA();d.init({speed:10,size:{x:20,y:20},isClose:true,noHoldExt:false,noColor:false});b("#run-check").on("click",function(){if(d.run_state()==false){d.start(),b(this).val("Stop")}else{d.pause(),b(this).val("Start")}});b("#run-next").on("click",function(){d.nextStep(),b("#run-check").val("Start")});b("#set-val-4").on("click",function(){d.setV(4)});b("#set-val-3").on("click",function(){d.setV(3)});b("#set-val-2").on("click",function(){d.setV(2)});b("#set-val-1").on("click",function(){d.setV(1)});b("#set-val-rnd").on("click",function(){d.setRandom()})})})(window,$);